# 기술적 제약사항 및 해결 전략 분석

## 1. 데이터 적재 관련

### 1.1 추후 센서 데이터 DB 적재
**현재 상황:**
- CSV 파일 기반 데이터 적재 (test 모드)
- 실제 환경에서는 센서에서 1초마다 DB로 전송되어야 함

**기술적 제약사항:**
- CSV → DB 적재 방식과 실시간 센서 → DB 적재 방식의 아키텍처 차이
- 데이터 포맷/스키마 일치성 검증 필요
- 대용량 CSV 파일 처리 시 성능 이슈 가능성

**해결 전략:**
- **통합 인터페이스 설계**: CSV 적재와 실시간 적재를 동일한 인터페이스로 추상화
- **배치 처리 최적화**: 대용량 CSV는 청크 단위로 분할하여 적재 (메모리 효율성)
- **스키마 검증**: CSV 데이터와 센서 데이터의 스키마 일치성 사전 검증 로직
- **모드 전환 메커니즘**: test → ops 모드 전환 시 데이터 파이프라인 무중단 전환

---

## 2. 실시간 AI 판단 관련

### 2.1 데이터가 DB로 전송되지 않는 상황
**시나리오:**
- 센서 장애, 네트워크 단절, DB 연결 실패 등으로 데이터 수신 중단

**기술적 제약사항:**
- 데이터 누락 시 이상치 판단 로직의 신뢰성 저하
- 연속된 데이터 포인트가 없으면 비교 기준 상실
- 타임스탬프 기반 예측 모델의 정확도 저하

**해결 전략:**
- **하트비트(Heartbeat) 메커니즘**: 센서/DB 연결 상태 모니터링, 주기적 상태 체크
- **데이터 누락 감지**: 예상 수신 시간 대비 실제 수신 시간 비교, 누락 알림 발송
- **보간(Interpolation) 전략**: 일시적 누락 시 이전 데이터 기반 보간 (단, 장기 누락은 별도 처리)
- **폴백(Fallback) 모드**: 데이터 수신 중단 시 마지막 정상 데이터 기반 경고 모드로 전환
- **재연결 자동화**: 네트워크 복구 시 자동 재연결 및 누락 구간 데이터 재요청

### 2.2 AI 스케줄이 밀린 경우
**시나리오:**
- 1초마다 데이터 수집되지만, AI 이상치 판단 처리 시간이 1초를 초과
- 대량의 데이터가 쌓이면서 처리 지연 발생

**기술적 제약사항:**
- 실시간성 요구사항과 처리 시간의 트레이드오프
- 큐잉 시스템 없이 순차 처리 시 데이터 누적 및 지연 확대
- 동시 처리 시 리소스 경합 및 성능 저하

**해결 전략:**
- **비동기 처리 아키텍처**: 데이터 수집과 AI 판단을 분리, 메시지 큐(Redis/RabbitMQ) 활용
- **우선순위 큐**: 최신 데이터 우선 처리, 오래된 데이터는 배치 처리로 전환
- **병렬 처리**: 여러 AI 인스턴스로 부하 분산 (Worker Pool 패턴)
- **타임아웃 설정**: 일정 시간 내 처리되지 않으면 스킵하고 다음 데이터 처리
- **백프레셔(Backpressure) 처리**: 큐 크기 임계값 초과 시 오래된 데이터 자동 삭제 또는 샘플링
- **모니터링**: 처리 지연 시간, 큐 크기, 처리량 메트릭 수집 및 알림

---

## 3. AI 연동 관련

### 3.1 LLM이 잘못된 개선안 추천한 경우
**시나리오:**
- MCP를 통해 이상치 데이터와 메뉴열을 입력했지만, LLM이 부적절하거나 위험한 조치사항 추천

**기술적 제약사항:**
- LLM의 확률적 특성으로 인한 일관성 없는 출력
- 도메인 지식 부족으로 인한 잘못된 추론
- 위험한 조치사항(예: 전원 차단, 시스템 재시작) 추천 가능성

**해결 전략:**
- **프롬프트 엔지니어링**: 명확한 제약사항과 금지 사항을 프롬프트에 명시
  - 예: "전원 차단, 시스템 재시작 등 위험한 조치는 추천하지 마세요"
- **검증 레이어**: LLM 출력 후 사전 정의된 위험 키워드 필터링
- **신뢰도 점수**: LLM이 추천한 조치사항에 대한 확신도(confidence) 제공
- **인간 검토(Review) 워크플로우**: 위험도가 높은 조치사항은 자동 적용 전 승인 필요
- **A/B 테스팅**: 여러 LLM 모델 또는 프롬프트 버전 비교 검증
- **피드백 루프**: 사용자가 조치사항 실행 후 결과를 피드백하여 모델 개선
- **템플릿 기반 폴백**: LLM 실패 시 사전 정의된 템플릿 기반 조치사항 제공

---

## 4. 웹 관련

### 4.1 장비에서 고장 신호를 보냈는데 웹으로 송신되지 못하는 경우
**시나리오:**
- 센서/장비에서 alarm 신호 발생 → DB 적재 성공 → 웹 서버로 전송 실패
- 또는 DB 적재 자체가 실패한 경우

**기술적 제약사항:**
- 단방향 통신 시 신호 손실 가능성
- 네트워크 장애, 웹 서버 다운, 브라우저 연결 끊김 등 다양한 실패 지점
- 실시간 알림 요구사항과 신뢰성의 트레이드오프

**해결 전략:**
- **양방향 확인(Acknowledgment)**: 웹 서버가 신호 수신 확인 후 DB에 상태 업데이트
- **재시도 메커니즘**: 전송 실패 시 지수 백오프(Exponential Backoff)로 재시도
- **WebSocket + 폴백**: 실시간 WebSocket 연결, 실패 시 Server-Sent Events(SSE) 또는 폴링으로 전환
- **로컬 버퍼링**: 웹 클라이언트가 연결 끊김 시 로컬 스토리지에 알림 저장, 재연결 시 동기화
- **다중 전송 경로**: WebSocket, HTTP 폴링, SSE 등 여러 경로로 중복 전송 (최소 하나 성공 보장)
- **우선순위 큐**: alarm 타입은 warning보다 높은 우선순위로 재시도
- **타임스탬프 기반 중복 제거**: 동일 시간대의 중복 알림 방지
- **상태 모니터링 대시보드**: 웹 서버 연결 상태, 전송 성공률, 실패 건수 모니터링

---

## 5. 추가 고려사항

### 5.1 데이터 일관성
- **트랜잭션 관리**: DB 적재와 이상치 판단 결과를 원자적으로 처리
- **데이터 검증**: CSV/센서 데이터의 유효성 검사 (범위, 타입, null 체크)

### 5.2 확장성
- **수평 확장**: 여러 센서/장비 지원 시 부하 분산
- **데이터 보관**: 3년치 데이터 처리 시 아카이빙 전략

### 5.3 보안
- **인증/인가**: 웹 대시보드 접근 제어
- **데이터 암호화**: 전송 중 데이터 암호화 (TLS/SSL)

### 5.4 모니터링 및 로깅
- **에러 로깅**: 모든 실패 지점에 대한 상세 로그
- **성능 메트릭**: 처리 시간, 처리량, 에러율 모니터링
- **알림 체인 추적**: 데이터 수집 → 이상치 판단 → AI 추천 → 웹 표시 전 과정 추적

---

## 6. 우선순위별 구현 권장사항

### 높은 우선순위 (필수)
1. 데이터 누락 감지 및 알림
2. AI 처리 지연 시 큐잉 시스템
3. 웹 전송 실패 시 재시도 메커니즘
4. LLM 출력 검증 레이어

### 중간 우선순위 (권장)
1. WebSocket + 폴백 전략
2. 우선순위 큐 구현
3. 상태 모니터링 대시보드

### 낮은 우선순위 (향후 개선)
1. A/B 테스팅
2. 피드백 루프
3. 다중 전송 경로




